---
name: useDynamicList
route: /useDynamicList
sidebar: true
---

import { Playground } from 'docz';
import { useState, useMemo } from 'react';
import { Button, Spin, Table, Form, Input } from 'antd';
import 'antd/es/select/style';
import useDynamicList from './index';
import ReactDragListView from 'react-drag-listview';

# useDynamicList

一个帮助你管理列表状态，并能生成唯一 key 的 hook。

## 代码演示

### 复杂 list

<Playground>
{
  ()=>{
    const Demo = Form.create()((props) => {
      const { list, merge, insert, replace, remove, getKey, move, push, unshift, pop } = useDynamicList([
        { name: 'aaa', age: 24 },
        { name: 'bbb', age: 23 },
        { name: 'ccc', age: 22 },
      ])
      const { getFieldDecorator, getFieldValue } = props.form;

      const columns = [
        {
          title: 'uuid(自动生成)',
          key: 'id',
          render: (text, row, index) => getKey(index)
        },
        {
          title: '姓名',
          dataIndex: 'name',
          key: 'name',
        },
        {
          title: '年龄',
          dataIndex: 'age',
          key: 'age',
        },
        {
          key: 'memo',
          title: '备注',
          render: (text, row, index) => 
            {
              return (
                <>
                  {getFieldDecorator(`memo[${getKey(index)}]`)(<Input style={{width: 300, marginRight: 16}} placeholder='please input the memo' />)}
                  <Button.Group>
                    <Button disabled={index === 0} onClick={()=>move(index, index - 1)}>上移</Button>
                    <Button disabled={index === list.length - 1 } onClick={()=>move(index, index + 1)}>下移</Button>
                    <Button type='danger' onClick={()=>remove(index)}>删除</Button>
                  </Button.Group>
                </>)
            }
          
        }
      ]

      return (
        <>
          <Table columns={columns} dataSource={list} rowKey={(r, index)=>getKey(index)} pagination={false} />
          <Button style={{marginTop: 8}} block type='dashed' onClick={()=>push({name: '新增行', age: '25'})}>+ 添加行</Button>
        </>
      )
    });
    return <Demo />
  }
}
</Playground>

### 动态表单

<Playground>
{
  ()=>{

    const Demo = Form.create()((props) => {
      const { list, merge, insert, replace, remove, getKey, move, push, unshift, pop, getIndex } = useDynamicList([{name: 'my bro', age: '23', memo: 'he\'s my bro' }, {name: 'my sis', age: '21', memo: 'she\'s my sis' }, {}])
      const { getFieldDecorator, getFieldsValue } = props.form;
      const [ result, setResult ] = useState('');

      const columns = [
        {
          title: '姓名',
          dataIndex: 'name',
          key: 'name',
          render: (text, row, index) => 
            {
              return (
                <>
                  {getFieldDecorator(`name[${getKey(index)}]`, { initialValue: text })(<Input style={{width: 120, marginRight: 16}} placeholder='name' />)}
                </>)
            }
        },
        {
          title: '年龄',
          dataIndex: 'age',
          key: 'age',
          render: (text, row, index) => 
            {
              return (
                <>
                  {getFieldDecorator(`age[${getKey(index)}]`, { initialValue: text })(<Input style={{width: 120, marginRight: 16}} placeholder='age' />)}
                </>)
            }
        },
        {
          key: 'memo',
          title: '备注',
          dataIndex: 'memo',
          render: (text, row, index) => 
            {
              return (
                <>
                  {getFieldDecorator(`memo[${getKey(index)}]`, { initialValue: text })(<Input style={{width: 300, marginRight: 16}} placeholder={`please input the memo`} />)}
                  <Button.Group>
                    <Button type='danger' onClick={()=>remove(index)}>删除</Button>
                  </Button.Group>
                </>)
            }
        }
      ]

      return (
        <>
          <ReactDragListView onDragEnd={(oldIndex, newIndex)=>move(oldIndex, newIndex)}>
            <Table columns={columns} dataSource={list} rowKey={(r, index)=>getKey(index)} pagination={false} />
          </ReactDragListView>
          <Button style={{marginTop: 8}} block type='dashed' onClick={()=>push({name: '新增行', age: '25'})}>+ 添加行</Button>
          <Button
            type='primary'
            style={{marginTop: 16}}
            onClick={()=>
              setResult(
                `names: 
                ${JSON.stringify(
                  getFieldsValue().name
                  .map((item, index)=> ({index, item})) // add index into obj
                  .sort((a, b) => getIndex(a.index) - getIndex(b.index)) // sort based on the index of table
                  .filter(item=>!!item.item) // remove undefined(s)
                  .map(item => item.item) // retrive the data
                )};
                ages: 
                ${JSON.stringify(
                  getFieldsValue().age
                  .map((item, index)=> ({index, item})) // add index into obj
                  .sort((a, b) => getIndex(a.index) - getIndex(b.index)) // sort based on the index of table
                  .filter(item=>!!item.item) // remove undefined(s)
                  .map(item => item.item) // retrive the data
                )};
                memos: 
                ${JSON.stringify(
                  getFieldsValue().memo
                  .map((item, index)=> ({index, item})) // add index into obj
                  .sort((a, b) => getIndex(a.index) - getIndex(b.index)) // sort based on the index of table
                  .filter(item=>!!item.item) // remove undefined(s)
                  .map(item => item.item) // retrive the data
                )};
                `
              )
            }>提交</Button>
          <div>{result && ('表单内容: ' + result)}</div>
        </>
      )
    });
    return <Demo />
  }
}
</Playground>

## API

### 入参

| 参数         | 说明         | 类型                 |   |
|--------------|--------------|----------------------|---|
| initialValue      | 列表的初始值 | T[]              |   |

### 返回结果

| 参数         | 说明         | 类型                 |  备注            |
|--------------|--------------|----------------------|---------------|
| list      | 当前的列表 | T[]              |   |
| insert        | 在指定位置插入元素 | (index: number, obj: T) => void                | - |
| merge         | 在指定位置插入多个元素 | (index: number, obj: T) => void | - |
| replace          | 替换指定元素         | (index: number, obj: T) => void          | - |
| remove   | 删除指定元素     | (index: number) => void;          | - |
| move | 移动元素     | (oldIndex: number, newIndex: number) => void;          | - |
| getKey  | 获得某个元素的 uuid     | (index: number) => number;           | - |
| getIndex  | 获得某个key的 index     | (key: number) => number;           | - |
| push  | 在列表末尾添加元素     | (obj: T) => void;          | - |
| pop  | 移除末尾元素     | () => void;          | - |
| unshift  | 在列表起始位置添加元素    | (obj: T) => void;          | - |
| shift  | 移除起始位置元素     | () => void;          | - |